<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title></title>
    <style>
    body {
      margin: 0 auto;
      width: 800px;
    }
    label {
      display: inline-block;
    }
    </style>
    <script src="ctx2dext.js"></script>
  </head>

  <body>
    <fieldset>
      <legend>Branch Options</legend>
      <label for=size>Length <input type=number name=size value=50></label>
      <label for=width>Width <input type=number name=width value=5></label> 
      <label for=width>Factor <input type=number name=branch-factor value=4 max=5></label>
      <label for=width>Angle <input type=number name=branch_angle value=45 max=90></label>
      <label for=width>Color <input type=color name=wood_color value="#A52A2A"></label>
    </fieldset>
    <fieldset>
      <legend>Options</legend>
      <label for=width>Size <input type=number name=leaf-size value=20 max=100></label>
      <label for=width>Color 1 <input type=color name=leaf_color1 value="#008000"></label>
      <label for=width>Color 2 <input type=color name=leaf_color2 value="#008000"></label>
      <label for=width>Color 3 <input type=color name=leaf_color3 value="#008000"></label>
    </fieldset>

    <input type=button name=redraw value=Redraw>
    
    <canvas width=800 height=400>
    </canvas>
    <script>
    const canvas = document.querySelector('canvas')
    const ctx = canvas.getContext("2d")

    function get(input) {
      return document.querySelector(`input[name=${input}]`).value
    }

    function doBranch(x, y, angle, depth) {
      if (depth > 10) return 

      const next_x = x+get('size')*Math.cos(angle*Math.PI/180)
      const next_y = y+get('size')*Math.sin(angle*Math.PI/180)
      ctx.strokeLine(x, y, next_x, next_y)

      const branches = Math.floor(Math.random()*get('branch-factor'))
      if (branches > 0) {
        for (let i = 0; i < branches; i++) {
          doBranch(next_x, next_y, angle + (Math.random() - .5) * 2 * get('branch_angle'), depth+1)
        }
      } else {
        ctx.fillStyle = get(`leaf_color${Math.floor(Math.random()*3)+1}`)
        ctx.fillCircle(next_x, next_y, get('leaf-size'))
      }
    }

    function render() {
      ctx.clearRect(0, 0, canvas.width, canvas.height)

      // Scale and tranform
      ctx.resetTransform()
      ctx.scale(1, -1)
      ctx.translate(0, -canvas.height)


      ctx.strokeStyle = get('wood_color')
      ctx.lineWidth = document.querySelector('input[name=width]').value
      ctx.strokeLine(canvas.width/2, 0, canvas.width/2, 150)

      doBranch(canvas.width/2, 150, 45, 0)
      doBranch(canvas.width/2, 150, 135, 0)
    }

    document.querySelectorAll('input').forEach(i => i.addEventListener('input', render))
    document.querySelector('input[name=redraw]').addEventListener('input', render)
    render()
    </script>
  </body>
</html>
