<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title></title>
    <style>
    canvas {
      display: block;
      border: 1px solid black;
    }
    </style>
    <script src="ctx2dext.js"></script>
  </head>

  <body>
    <label for=size>Size</label><input type=number name=size value=50>
    <label for=width>Width</label><input type=number name=width value=5>
    <canvas width=800 height=600>
    </canvas>
    <script>
    const canvas = document.querySelector('canvas')
    const ctx = canvas.getContext("2d")

    function doBranch(x, y, angle, depth) {
      if (depth > 10) return 

      const size = parseInt(document.querySelector('input[name=size]').value)
    
      const next_x = x+size*Math.cos(angle*Math.PI/180)
      const next_y = y+size*Math.sin(angle*Math.PI/180)
      ctx.strokeLine(x, y, next_x, next_y)

      const branches = Math.floor(Math.random()*4)
      if (branches > 0) {
        for (let i = 0; i < branches; i++) {
          doBranch(next_x, next_y, angle + (Math.random() - .5) * 90, depth+1)
        }
      } else {
        ctx.fillCircle(next_x, next_y, 20)
      }
    }

    function render() {
      ctx.clearRect(0, 0, canvas.width, canvas.height)

      // Scale and tranform
      ctx.resetTransform()
      ctx.scale(1, -1)
      ctx.translate(0, -600)


      ctx.strokeStyle = 'brown'
      ctx.fillStyle = 'green'
      ctx.lineWidth = document.querySelector('input[name=width]').value
      ctx.strokeLine(canvas.width/2, 0, canvas.width/2, 150)

      doBranch(canvas.width/2, 150, 45, 0)
      doBranch(canvas.width/2, 150, 135, 0)
    }

    document.querySelectorAll('input').forEach(i => i.addEventListener('input', render))
    render()
    </script>
  </body>
</html>
