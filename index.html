<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title></title>
    <style>
    canvas {
      display: block;
      border: 1px solid black;
    }
    label {
      display: inline-block;
    }
    </style>
    <script src="ctx2dext.js"></script>
  </head>

  <body>
    <label for=size>Size</label><input type=number name=size value=50>
    <label for=width>Width</label><input type=number name=width value=5>
    <label for=width>Branch Factor</label><input type=number name=branch-factor value=4 max=5>
    <label for=width>Leaf Size</label><input type=number name=leaf-size value=20 max=100>
    <br />
    <label for=width>Wood Color</label><input type=color name=wood_color value="#A52A2A">
    <label for=width>Leaf Color 1</label><input type=color name=leaf_color1 value="#008000">
    <label for=width>Leaf Color 2</label><input type=color name=leaf_color2 value="#008000">
    <label for=width>Leaf Color 3</label><input type=color name=leaf_color3 value="#008000">
    
    <canvas width=800 height=600>
    </canvas>
    <script>
    const canvas = document.querySelector('canvas')
    const ctx = canvas.getContext("2d")

    function get(input) {
      return document.querySelector(`input[name=${input}]`).value
    }

    function doBranch(x, y, angle, depth) {
      if (depth > 10) return 

      const next_x = x+get('size')*Math.cos(angle*Math.PI/180)
      const next_y = y+get('size')*Math.sin(angle*Math.PI/180)
      ctx.strokeLine(x, y, next_x, next_y)

      const branches = Math.floor(Math.random()*get('branch-factor'))
      if (branches > 0) {
        for (let i = 0; i < branches; i++) {
          doBranch(next_x, next_y, angle + (Math.random() - .5) * 90, depth+1)
        }
      } else {
        ctx.fillStyle = get(`leaf_color${Math.floor(Math.random()*3)+1}`)
        ctx.fillCircle(next_x, next_y, get('leaf-size'))
      }
    }

    function render() {
      ctx.clearRect(0, 0, canvas.width, canvas.height)

      // Scale and tranform
      ctx.resetTransform()
      ctx.scale(1, -1)
      ctx.translate(0, -600)


      ctx.strokeStyle = get('wood_color')
      ctx.lineWidth = document.querySelector('input[name=width]').value
      ctx.strokeLine(canvas.width/2, 0, canvas.width/2, 150)

      doBranch(canvas.width/2, 150, 45, 0)
      doBranch(canvas.width/2, 150, 135, 0)
    }

    document.querySelectorAll('input').forEach(i => i.addEventListener('input', render))
    render()
    </script>
  </body>
</html>
